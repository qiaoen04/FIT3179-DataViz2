<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:#0b1e3a;               
  }
  .wrap{max-width:1200px;margin:auto;display:grid;grid-template-columns:1fr 1fr;gap:24px;padding:24px}
  .full{grid-column:1 / -1}

  /* Cards */
  .card{
    background:#fff;                   /* ← white cards */
    border-radius:12px;
    padding:14px;
    box-shadow:0 6px 24px rgba(0,0,0,.2);
  }

  /* Optional: a simple header that sits on dark blue */
  header{color:#fff;text-align:center;padding:28px 0 8px}
  h3{margin:6px 0 12px 4px;color:#0b1e3a}  /* dark title inside white cards */
  .sub,.obs,.tip{color:#2b2b2b}
</style>

</head>
<body>
<!-- MAIN PAGE TITLE -->
<header style="text-align:center; padding:28px 0 8px 0; background:#f8fafc;">
  <h1 style="margin:0; font-size:28px; font-weight:700;">The Olympic Story in Data</h1>
  <p style="margin:6px 0 0 0; font-size:16px; color:#555;">
    Exploring medals, participation, and performance across nations and time.
  </p>
</header>

<div class="wrap">

  <!-- MAP (left) -->
  <div class="card">
    <h3>Where Do the Medals Live?</h3>
    <p class="sub">Total medals earned by each nation across modern Olympics.</p>
    <div id="map-view"></div>
    <ul class="obs">
      <li>Medals concentrate among a handful of long-participating nations.</li>
      <li>Europe & North America dominate, with strong pockets in East Asia/Oceania.</li>
      <li>Lighter tones show smaller or newer NOCs.</li>
    </ul>
  </div>


  <!-- DONUT (right) -->
  <div class="card">
    <h3>Gold–Silver–Bronze Split</h3>
    <p class="sub">Pick a country to see its medal composition.</p>
    <div id="donut-view"></div>
    <div id="donut-controls" class="controls"></div>
    <p class="tip">Tip: Try USA, China, or Norway for contrasts.</p>
    <ul class="obs">
      <li>Balanced splits = broad strengths; emerging teams often skew bronze.</li>
      <li>High gold share signals dominance in select events.</li>
      <li>Similar totals can hide different “quality” mixes.</li>
    </ul>
  </div>


  <!-- BAR (bottom, full width) -->
  <div class="card full">
    <h3>How Athlete Participation Grew</h3>
    <p class="sub">Summer = stacked bars; Winter = lines. Use the selector to focus.</p>
    <div id="bar-view"></div>
    <div id="bar-controls" class="controls"></div>
    <ul class="obs">
      <li>Sharp growth post mid-20th century.</li>
      <li>Women’s share rises steadily.</li>
      <li>Winter is lower overall but trends similarly.</li>
    </ul>
  </div>


  <!-- HEATMAP (bottom, full width) -->
<div class="card full">
  <h3>Specialisations by Nation</h3>
  <p class="sub">Darker cells = more medals for that country–sport pair.</p>
  <div id="heatmap-view"></div>
  <p class="tip">Hover cells to compare focus vs overall totals.</p>
  <ul class="obs">
    <li>“Stripes” reveal national specialisations.</li>
    <li>Some countries cluster medals in a few disciplines.</li>
    <li>Dark outliers show unexpected strengths.</li>
  </ul>
</div>


<!-- AGE & BMI (full width) -->
<div class="card full">
  <h3>Who Reaches the Podium?</h3>
  <p class="sub">Distribution of Age and BMI among medal winners.</p>
  <div id="age-bmi-view"></div>
  <ul class="obs">
    <li>Median ages across medal types are similar; extremes are rare.</li>
    <li>BMI spans widely, reflecting sport diversity.</li>
    <li>Gold distributions are tighter—peak performance bands.</li>
  </ul>
</div>



<script>
  // ---------- MAP (choropleth) ----------
const mapSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Olympic Medals (Normalized by Top Country)",
  "width": 540,
  "height": 330,
  "projection": {"type": "equalEarth"},
  "layer": [
    { 
      "data": {"sphere": true},
      "mark": {"type": "geoshape", "fill": "#eef6fb", "stroke": null}
    },
    { 
      "data": {"graticule": true},
      "mark": {"type": "geoshape", "stroke": "#c7d2d9", "strokeWidth": 0.5}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "mark": {"type": "geoshape", "fill": "#f2efe9", "stroke": "#ffffff", "strokeWidth": 0.3}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "transform": [
        {
          "lookup": "properties.NAME",
          "from": {
            "data": {"url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/olympic.csv"},
            "key": "country",
            "fields": ["OlympicMedalsTotal_2022", "OlympicMedalsGold", "OlympicMedalsSilver", "OlympicMedalsBronze"]
          }
        },
        {"calculate": "toNumber(datum.OlympicMedalsTotal_2022)", "as": "Medals"},
        {"calculate": "datum.Medals / 3105", "as": "MedalsNormalized"}  // normalization step
      ],
      "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 0.3},
      "encoding": {
        "color": {
          "field": "MedalsNormalized",
          "type": "quantitative",
          "scale": {"type": "linear", "domain": [0, 1]},
          "legend": {"title": "Normalized Medal Score", "orient": "right"}
        },
        "tooltip": [
          {"field": "properties.NAME", "type": "nominal", "title": "Country"},
          {"field": "Medals", "type": "quantitative", "title": "Total"},
          {"field": "OlympicMedalsGold", "type": "quantitative", "title": "Gold"},
          {"field": "OlympicMedalsSilver", "type": "quantitative", "title": "Silver"},
          {"field": "OlympicMedalsBronze", "type": "quantitative", "title": "Bronze"},
          {"field": "MedalsNormalized", "type": "quantitative", "title": "Normalized (0–1)"}
        ]
      }
    }
  ]
};


  // ---------- DONUT (country picker under chart) ----------
const donutSpec = {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "title": {"text": "Medal Mix by Country", "fontSize": 16},
  "width": 540,
  "height": 330,
  "data": {
    "url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/olympic.csv"
  },

  "params":[
    {
      "name":"country_sel",
      "value":"United States of America",   // <-- default selection
      "bind":{
        "input":"select",
        "name":" Country: ",
        "options":[
          "Afghanistan","Algeria","Andorra","Argentina","Armenia","Australia","Austria",
          "Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium",
          "Bermuda","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil",
          "Bulgaria","Burkina Faso","Burundi","Cambodia","Cameroon","Canada","Chile",
          "China","Colombia","Costa Rica","Croatia","Cuba","Cyprus","Czechia","Denmark",
          "Djibouti","Dominican Republic","Ecuador","Egypt","El Salvador","Eritrea",
          "Estonia","Ethiopia","Fiji","Finland","France","Gabon","Georgia","Germany",
          "Ghana","Greece","Grenada","Guatemala","Guyana","Haiti","Hong Kong S.A.R",
          "Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy",
          "Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kuwait","Kyrgyzstan","Latvia",
          "Lebanon","Liechtenstein","Lithuania","Luxembourg","Malaysia","Mexico","Moldova",
          "Monaco","Mongolia","Montenegro","Morocco","Mozambique","Myanmar","Namibia",
          "Nauru","Netherlands","New Zealand","Nigeria","North Korea","North Macedonia",
          "Norway","Pakistan","Panama","Paraguay","Peru","Philippines","Poland","Portugal",
          "Puerto Rico","Qatar","Romania","Russia","San Marino","Saudi Arabia","Senegal",
          "Serbia","Singapore","Slovakia","Slovenia","South Africa","South Korea","Spain",
          "Sri Lanka","Suriname","Sweden","Switzerland","Syria","Taiwan","Tajikistan",
          "Tanzania","Thailand","Togo","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan",
          "Uganda","Ukraine","United Arab Emirates","United Kingdom","United States of America",
          "Uruguay","Uzbekistan","Venezuela","Vietnam","Zambia","Zimbabwe"
        ],
        "element":"#donut-controls"
      }
    }
  ],

  "transform": [
    {"filter": "datum.country && datum.country != 'Total'"},
    {"fold": ["OlympicMedalsGold","OlympicMedalsSilver","OlympicMedalsBronze"], "as": ["MedalType","Count"]},
    {"calculate": "datum.MedalType == 'OlympicMedalsGold' ? 'Gold' : datum.MedalType == 'OlympicMedalsSilver' ? 'Silver' : 'Bronze'", "as": "Medal"},
    {"aggregate": [{"op":"sum","field":"Count","as":"Count"}], "groupby":["country","Medal"]},
    {"joinaggregate": [{"op":"sum","field":"Count","as":"Total"}], "groupby":["country"]},
    {"calculate": "round(datum.Count / datum.Total * 100)", "as": "Pct"}
  ],

  "layer": [
    // (Optional) You can delete the placeholder ring since we now have a default selection.
    {
      "transform": [{"filter": "country_sel == null"}],
      "mark": {"type":"arc","innerRadius":90,"outerRadius":150,"color":"#e0e0e0"},
      "encoding": {"theta": {"value": 6.283}}
    },
    {
      "transform": [{"filter": "country_sel == null"}],
      "mark": {"type":"text","radius":0,"dy":5,"fontSize":14,"fontWeight":"bold"},
      "encoding": {"text": {"value":"Select a country"}, "color":{"value":"#666"}}
    },

    {
      "transform": [{"filter": "datum.country == country_sel"}],
      "mark": {"type":"arc","innerRadius":90,"outerRadius":150},
      "encoding": {
        "theta": {"field":"Count","type":"quantitative"},
        "color": {
          "field":"Medal","type":"nominal",
          "sort":["Gold","Silver","Bronze"],
          "scale":{"range":["#d4af37","#c0c0c0","#cd7f32"]},
          "title":"Medal Type"
        },
        "tooltip": [
          {"field":"country","title":"Country"},
          {"field":"Medal","title":"Medal"},
          {"field":"Count","title":"Medals"},
          {"field":"Pct","title":"Share (%)"},
          {"field":"Total","title":"Total"}
        ]
      }
    },
    {
      "transform": [{"filter": "datum.country == country_sel"}],
      "mark": {"type":"text","radius":0,"dy":5,"fontSize":12,"fontWeight":"bold"},
      "encoding": {"text": {"field":"country"}}
    }
  ]
};


  // ---------- BAR (Season picker under chart) ----------
  const barSpec = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "title": "Participation — Summer (Stacked Bars) + Winter (Lines)",
    "width": 1120,
    "height": 420,
    "data": {
      "url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/athlete_events.csv",
      "format": {"type": "csv"}
    },
    "params":[
      {
        "name":"season_selection",
        "value": null,
        "bind":{
          "input":"select",
          "options":[null,"Summer","Winter"],
          "labels":["— All seasons —","Summer","Winter"],
          "name":"Season: ",
          "element":"#bar-controls"
        }
      }
    ],
    "transform": [
      {"filter": "isValid(datum.Year) && datum.Sex != null && datum.Season != null"},
      {"aggregate": [{"op":"count","as":"Entries"}], "groupby": ["Year","Sex","Season"]}
    ],
    "encoding": {
      "x": {"field": "Year", "type": "quantitative", "axis": {"format": "d", "title": "Year"}},
      "color": {
        "field": "Sex",
        "type": "nominal",
        "scale": {"domain": ["F", "M"], "range": ["#f0add5", "#8bc8f0"]},
        "legend": {"title": "Sex", "orient": "right", "direction": "vertical", "titleFontSize": 12, "labelFontSize": 11, "symbolType": "circle", "offset": 10}
      }
    },
    "layer": [
      {
        "name": "Summer (stacked bars)",
        "transform": [{"filter": "datum.Season == 'Summer'"}],
        "mark": {"type": "bar"},
        "encoding": {
          "y": {"field": "Entries", "type": "quantitative", "title": "Entries"},
          "size": {"value": 25},
          "opacity": {"condition": {"test": "season_selection == null || season_selection == 'Summer'", "value": 0.9}, "value": 0},
          "tooltip": [
            {"field":"Year","type":"quantitative","format":"d","title":"Year"},
            {"field":"Season","type":"nominal","title":"Season"},
            {"field":"Sex","type":"nominal"},
            {"field":"Entries","type":"quantitative","format":",","title":"Entries"}
          ]
        }
      },
      {
        "name": "Winter (lines)",
        "transform": [{"filter": "datum.Season == 'Winter'"}],
        "mark": {"type": "line", "point": true, "strokeWidth": 2},
        "encoding": {
          "y": {"field": "Entries", "type": "quantitative"},
          "opacity": {"condition": {"test": "season_selection == null || season_selection == 'Winter'", "value": 1}, "value": 0},
          "tooltip": [
            {"field":"Year","type":"quantitative","format":"d","title":"Year"},
            {"field":"Season","type":"nominal","title":"Season"},
            {"field":"Sex","type":"nominal"},
            {"field":"Entries","type":"quantitative","format":",","title":"Entries"}
          ]
        }
      },
      {
        "name": "Summer total labels (all years)",
        "transform": [
          {"filter": "datum.Season == 'Summer'"},
          {"aggregate": [{"op": "sum", "field": "Entries", "as": "Total"}], "groupby": ["Year"]}
        ],
        "mark": {"type": "text", "dy": -6, "fontSize": 11, "stroke": "black", "strokeWidth": 1},
        "encoding": {
          "x": {"field": "Year", "type": "quantitative"},
          "y": {"field": "Total", "type": "quantitative"},
          "text": {"field": "Total", "type": "quantitative", "format": ",d"},
          "opacity": {"condition": {"test": "season_selection == null || season_selection == 'Summer'", "value": 1}, "value": 0},
          "tooltip": [
            {"field": "Year", "type": "quantitative", "format": "d", "title": "Year"},
            {"field": "Total", "type": "quantitative", "format": ",d", "title": "Summer total"}
          ]
        }
      }
    ]
  };

  const heatMapSpec = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "title": {
    "text": "Total Medals by Sport and Country (Top 20 Countries)",
    "fontSize": 16
  },

  "data": {
    "url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/refs/heads/main/top21_country_20sport_medals.csv"
  },

  "mark": "rect",

  "encoding": {
    "x": {
      "field": "Sport",
      "type": "nominal",
      "title": "Sport",
      "axis": {"labelAngle": -45, "labelFontSize": 10},
      "sort": "ascending"
    },
    "y": {
      "field": "Team",
      "type": "nominal",
      "title": "Country",
      "sort": {"field": "Country_Total", "op": "max", "order": "descending"}
    },
    "color": {
      "field": "Total_Medals",
      "type": "quantitative",
      "title": "Total Medals",
      "scale": {"scheme": "goldred"}
    },
    "tooltip": [
      {"field": "Team", "title": "Country"},
      {"field": "Sport", "title": "Sport"},
      {"field": "Total_Medals", "title": "Total Medals"},
      {"field": "Country_Total", "title": "Country Total"}
    ]
  },

  "config": {
    "axis": {"titleFontSize": 13, "labelFontSize": 10},
    "view": {"stroke": "transparent"}
  }
  };

  // ---------- AGE & BMI BOXPLOTS (full width) ----------
const ageBmiSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Age and BMI Distribution by Medal Type",
  "data": {
    "url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/athletes_with_bmi.csv"
  },
  "transform": [
    {"filter": "datum.Medal != null && datum.Medal != 'NA'"},
    {
      // BMI = weight(kg) / (height(m))^2 ; height is in cm in this file
      "calculate": "datum.Weight / ((datum.Height/100)*(datum.Height/100))",
      "as": "BMI"
    }
  ],
  "hconcat": [
    {
      "mark": {"type": "boxplot", "size": 70},
      "width": 520,
      "height": 360,
      "encoding": {
        "x": {"field": "Medal", "type": "nominal", "title": "Medal Type", "sort": ["Gold","Silver","Bronze"]},
        "y": {"field": "Age", "type": "quantitative", "title": "Age"},
        "color": {
          "field": "Medal", "type": "nominal",
          "scale": {"domain": ["Gold","Silver","Bronze"], "range": ["#FFD700","#C0C0C0","#CD7F32"]},
          "title": "Medal Type"
        },
        "tooltip": [{"field":"Medal","title":"Medal Type"},{"field":"Age","title":"Age"}]
      }
    },
    {
      "mark": {"type": "boxplot", "size": 70},
      "width": 520,
      "height": 360,
      "encoding": {
        "x": {"field": "Medal", "type": "nominal", "title": "Medal Type", "sort": ["Gold","Silver","Bronze"]},
        "y": {"field": "BMI", "type": "quantitative", "title": "BMI"},
        "color": {
          "field": "Medal", "type": "nominal",
          "scale": {"domain": ["Gold","Silver","Bronze"], "range": ["#FFD700","#C0C0C0","#CD7F32"]},
          "legend": null
        },
        "tooltip": [{"field":"Medal","title":"Medal Type"},{"field":"BMI","title":"BMI"}]
      }
    }
  ],
  // You asked for independent color resolution — included for completeness
  "resolve": {
    "scale": {"color": "independent"},
    "legend": {"color": "independent"}
  }
};

  vegaEmbed("#map-view", mapSpec, {actions:false});
  vegaEmbed("#donut-view", donutSpec, {actions:false});
  vegaEmbed("#bar-view", barSpec, {actions:false});
  vegaEmbed("#heatmap-view", heatMapSpec, {actions:false});
  vegaEmbed("#age-bmi-view", ageBmiSpec, {actions:false});

</script>
</body>
</html>
