<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1200px;margin:auto;display:grid;grid-template-columns:1fr 1fr;gap:24px;padding:24px}
    .full{grid-column:1 / -1}
    .card{background:#fff;border-radius:12px;padding:14px;box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .controls{margin-top:10px}
    .controls label{margin-right:8px}
    h3{margin:6px 0 12px 4px}
  </style>
</head>
<body>

<div class="wrap">
  <!-- MAP (left) -->
  <div class="card">
    <h3>Olympic Medals by Country (Total)</h3>
    <div id="map-view"></div>
  </div>

  <!-- DONUT (right) -->
  <div class="card">
    <h3>Medal Mix — Select a Country (control below)</h3>
    <div id="donut-view"></div>
    <div id="donut-controls" class="controls"></div>
  </div>

  <!-- BAR (bottom, full width) -->
  <div class="card full">
    <h3>Participation by Year — Stacked by Sex (control below)</h3>
    <div id="bar-view"></div>
    <div id="bar-controls" class="controls"></div>
  </div>
</div>

<script>
  // ---------- MAP (choropleth) ----------
  const mapSpec = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "title": "Olympic medals for each countries",
    "width": 540,
    "height": 330,
    "projection": {"type": "equalEarth"},
    "layer": [
      { "data": {"sphere": true},
        "mark": {"type": "geoshape", "fill":"#eef6fb", "stroke": null}
      },
      { "data": {"graticule": true},
        "mark": {"type": "geoshape", "stroke": "#c7d2d9", "strokeWidth": 0.5}
      },
      {
        "data": {
          "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
          "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
        },
        "mark": {"type": "geoshape", "fill": "#f2efe9", "stroke": "#ffffff", "strokeWidth": 0.3}
      },
      {
        "data": {
          "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
          "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
        },
        "transform": [
          {
            "lookup": "properties.NAME",
            "from": {
              "data": {"url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/olympic.csv"},
              "key": "country",
              "fields": ["OlympicMedalsTotal_2022","OlympicMedalsGold","OlympicMedalsSilver","OlympicMedalsBronze"]
            }
          },
          {"calculate": "toNumber(datum.OlympicMedalsTotal_2022)", "as": "Medals"}
        ],
        "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 0.3},
        "encoding": {
          "color": {
            "field": "Medals",
            "type": "quantitative",
            "scale": {"type": "log", "domainMin": 1},
            "legend": {"title": "Total medals", "orient": "right"}  
          },
          "tooltip": [
            {"field": "properties.NAME", "type": "nominal", "title": "Country"},
            {"field": "Medals", "type": "quantitative", "title": "Total"},
            {"field": "OlympicMedalsGold", "type": "quantitative", "title": "Gold"},
            {"field": "OlympicMedalsSilver", "type": "quantitative", "title": "Silver"},
            {"field": "OlympicMedalsBronze", "type": "quantitative", "title": "Bronze"}
          ]
        }
      }
    ]
  };

  // ---------- DONUT (country picker under chart) ----------
  const donutSpec = {
        "title": {"text": "Medal Mix by Country (One Donut per Country)", "fontSize": 16},
        
        "width": 280,
        "height": 280,
        "data": {
          "url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/olympic.csv"
        },
        "transform": [
          {"filter": "datum.country && datum.country != 'Total'"},
          {
            "fold": ["OlympicMedalsGold", "OlympicMedalsSilver", "OlympicMedalsBronze"],
            "as": ["MedalType", "Count"]
          },
          {
            "calculate": "datum.MedalType == 'OlympicMedalsGold' ? 'Gold' : datum.MedalType == 'OlympicMedalsSilver' ? 'Silver' : 'Bronze'",
            "as": "Medal"
          },
          {"aggregate": [{"op": "sum", "field": "Count", "as": "Count"}], "groupby": ["country", "Medal"]},
          {"joinaggregate": [{"op": "sum", "field": "Count", "as": "Total"}], "groupby": ["country"]},
          {"calculate": "round(datum.Count / datum.Total * 100)", "as": "Pct"}
        ],
        "layer": [
          {
            "transform": [{"filter": "country_sel == null"}],
            "mark": {"type": "arc", "innerRadius": 70, "outerRadius": 130, "color": "#e0e0e0"},
            "encoding": {"theta": {"value": 7}}
          },
          {
            "transform": [{"filter": "country_sel == null"}],
            "mark": {"type": "text", "radius": 0, "dy": 5, "fontSize": 14, "fontWeight": "bold"},
            "encoding": {"text": {"value": "Select a country"}, "color": {"value": "#666"}}
          },
          {
            "transform": [{"filter": "datum.country == country_sel"}],
            "mark": {"type": "arc", "innerRadius": 50, "outerRadius": 100},
            "encoding": {
              "theta": {"field": "Count", "type": "quantitative", "stack": true},
              "color": {
                "field": "Medal",
                "type": "nominal",
                "sort": ["Gold", "Silver", "Bronze"],
                "scale": {"range": ["#d4af37", "#c0c0c0", "#cd7f32"]},
                "legend": {
                  "title": "Medal Type",
                  "orient": "right",
                  "offset": 0,
                  "symbolType": "circle"
                }
              },
              "tooltip": [
                {"field": "country", "title": "Country"},
                {"field": "Medal", "title": "Medal"},
                {"field": "Count", "title": "Medals"},
                {"field": "Pct", "title": "Share (%)"},
                {"field": "Total", "title": "Total"}
              ]
            }
          },
          {
            "transform": [{"filter": "datum.country == country_sel"}],
            "mark": {"type": "text", "radius": 0, "dy": 5, "fontSize": 12, "fontWeight": "bold"},
            "encoding": {"text": {"field": "country"}}
          },
     
        ]
      };

  // ---------- BAR (Season picker under chart) ----------
  const barSpec = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "title": "Participation — Summer (Stacked Bars) + Winter (Lines)",
    "width": 1120,
    "height": 420,
    "data": {
      "url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/athlete_events.csv",
      "format": {"type": "csv"}
    },
    "params":[
      {
        "name":"season_selection",
        "value": null,
        "bind":{
          "input":"select",
          "options":[null,"Summer","Winter"],
          "labels":["— All seasons —","Summer","Winter"],
          "name":"Season: ",
          "element":"#bar-controls"
        }
      }
    ],
    "transform": [
      {"filter": "isValid(datum.Year) && datum.Sex != null && datum.Season != null"},
      {"aggregate": [{"op":"count","as":"Entries"}], "groupby": ["Year","Sex","Season"]}
    ],
    "encoding": {
      "x": {"field": "Year", "type": "quantitative", "axis": {"format": "d", "title": "Year"}},
      "color": {
        "field": "Sex",
        "type": "nominal",
        "scale": {"domain": ["F", "M"], "range": ["#f0add5", "#8bc8f0"]},
        "legend": {"title": "Sex", "orient": "right", "direction": "vertical", "titleFontSize": 12, "labelFontSize": 11, "symbolType": "circle", "offset": 10}
      }
    },
    "layer": [
      {
        "name": "Summer (stacked bars)",
        "transform": [{"filter": "datum.Season == 'Summer'"}],
        "mark": {"type": "bar"},
        "encoding": {
          "y": {"field": "Entries", "type": "quantitative", "title": "Entries"},
          "size": {"value": 25},
          "opacity": {"condition": {"test": "season_selection == null || season_selection == 'Summer'", "value": 0.9}, "value": 0},
          "tooltip": [
            {"field":"Year","type":"quantitative","format":"d","title":"Year"},
            {"field":"Season","type":"nominal","title":"Season"},
            {"field":"Sex","type":"nominal"},
            {"field":"Entries","type":"quantitative","format":",","title":"Entries"}
          ]
        }
      },
      {
        "name": "Winter (lines)",
        "transform": [{"filter": "datum.Season == 'Winter'"}],
        "mark": {"type": "line", "point": true, "strokeWidth": 2},
        "encoding": {
          "y": {"field": "Entries", "type": "quantitative"},
          "opacity": {"condition": {"test": "season_selection == null || season_selection == 'Winter'", "value": 1}, "value": 0},
          "tooltip": [
            {"field":"Year","type":"quantitative","format":"d","title":"Year"},
            {"field":"Season","type":"nominal","title":"Season"},
            {"field":"Sex","type":"nominal"},
            {"field":"Entries","type":"quantitative","format":",","title":"Entries"}
          ]
        }
      },
      {
        "name": "Summer total labels (all years)",
        "transform": [
          {"filter": "datum.Season == 'Summer'"},
          {"aggregate": [{"op": "sum", "field": "Entries", "as": "Total"}], "groupby": ["Year"]}
        ],
        "mark": {"type": "text", "dy": -6, "fontSize": 11, "stroke": "black", "strokeWidth": 1},
        "encoding": {
          "x": {"field": "Year", "type": "quantitative"},
          "y": {"field": "Total", "type": "quantitative"},
          "text": {"field": "Total", "type": "quantitative", "format": ",d"},
          "opacity": {"condition": {"test": "season_selection == null || season_selection == 'Summer'", "value": 1}, "value": 0},
          "tooltip": [
            {"field": "Year", "type": "quantitative", "format": "d", "title": "Year"},
            {"field": "Total", "type": "quantitative", "format": ",d", "title": "Summer total"}
          ]
        }
      }
    ]
  };

  vegaEmbed("#map-view", mapSpec, {actions:false});
  vegaEmbed("#donut-view", donutSpec, {actions:false});
  vegaEmbed("#bar-view", barSpec, {actions:false});
</script>
</body>
</html>
