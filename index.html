<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Total Olympic Medals by Country</title>
  <!-- Vega, Vega-Lite v6, Vega-Embed -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@6"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #vis { max-width: 1000px; margin: 24px auto; }
  </style>
</head>
<body>
  <h1 style="text-align:center;margin-top:16px;">Total Olympic Medals by Country</h1>
  <div id="vis"></div>

  <script>
  const spec = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "params": [{
          "name": "season_selection",
          "value": null,
          "bind": {
            "input": "select",
            "options": [null, "Summer", "Winter"],
            "labels": ["Show All", "Summer", "Winter"],
            "name": " Season "
          }
        }],
    "vconcat": [
      {
        "title": "Olympic medals for each countries",
  "width": 800,
  "height": 400,
  "projection": {"type": "equalEarth"},
  "layer": [
    { "data": {"sphere": true},
      "mark": {"type": "geoshape", "fill":"#eef6fb", "stroke": null}
    },
    { "data": {"graticule": true},
      "mark": {"type": "geoshape", "stroke": "#c7d2d9", "strokeWidth": 0.5}
    },

    
    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "mark": {"type": "geoshape", "fill": "#f2efe9", "stroke": "#ffffff", "strokeWidth": 0.3}
    },

    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "transform": [
        {
          "lookup": "properties.NAME",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/olympic.csv"
            },
            "key": "country",
            "fields": ["OlympicMedalsTotal_2022"]
          }
        },
        {"calculate": "toNumber(datum.OlympicMedalsTotal_2022)", "as": "Medals"}
      ],
      "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 0.3},
      "encoding": {
        "color": {
          "field": "Medals",
          "type": "quantitative",
          "scale": {"type": "log", "domainMin": 1},
          "legend": {"title": "Total medals"}
        },
        "tooltip": [
          {"field": "properties.NAME", "type": "nominal", "title": "Country"},
          {"field": "Medals", "type": "quantitative", "title": "Medals"}
        ]
      }
    }
  ]
      },
      {
        "title": "Participation - Summer (Stacked Bars) + Winter (Lines)",
        "width": 900,
        "height": 420,
        "data": {
          "url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/athlete_events.csv",
          "format": {"type": "csv"}
        },
          

        "transform": [
          {"filter": "isValid(datum.Year) && datum.Sex != null && datum.Season != null"},
          {"aggregate": [{"op":"count","as":"Entries"}], "groupby": ["Year","Sex","Season"]}
        ],

        "encoding": {
          "x": {"field": "Year", "type": "quantitative", "axis": {"format": "d", "title": "Year"}},
          "color": {
            "field": "Sex", "type": "nominal",
            "scale": {"domain": ["F","M"], "range": ["#f0add5","#8bc8f0"]},
            "legend": {"title": "Sex"}
          }
        },

        "layer": [
          {
            "name": "Summer (stacked bars)",
            "transform": [{"filter": "datum.Season == 'Summer'"}],
            "mark": {"type":"bar"},
            "encoding": {
              "y": {"field":"Entries","type":"quantitative","title":"Entries"},
              "size": {"value": 25},
              "opacity": {
                "condition": {"test": "season_selection == null || season_selection == 'Summer'", "value": 0.9},
                "value": 0
              },
              "tooltip": [
                {"field":"Year","type":"quantitative","format":"d","title":"Year"},
                {"field":"Season","type":"nominal","title":"Season"},
                {"field":"Sex","type":"nominal"},
                {"field":"Entries","type":"quantitative","format":",","title":"Entries"}
              ]
            }
          },
          {
            "name": "Winter (lines)",
            "transform": [{"filter": "datum.Season == 'Winter'"}],
            "mark": {"type":"line","point": true, "strokeWidth": 2},
            "encoding": {
              "y": {"field":"Entries","type":"quantitative"},
              "opacity": {
                "condition": {"test": "season_selection == null || season_selection == 'Winter'", "value": 1},
                "value": 0
              },
              "tooltip": [
                {"field":"Year","type":"quantitative","format":"d","title":"Year"},
                {"field":"Season","type":"nominal","title":"Season"},
                {"field":"Sex","type":"nominal"},
                {"field":"Entries","type":"quantitative","format":",","title":"Entries"}
              ]
            }
          }
        ]
      }
    ],

    "spacing": 30
  }

;

  vegaEmbed('#vis', spec, {actions: {export:true, source:false, compiled:false, editor:false}});
  </script>
</body>
</html>
