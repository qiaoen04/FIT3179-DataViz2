<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    .wrap{max-width:1150px;margin:auto;display:grid;grid-template-columns:1fr;gap:24px}
    .card{background:#fff;border-radius:10px;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .controls{margin-top:10px}
    .controls label{margin-right:8px}
  </style>
</head>
<body>
<div class="wrap">

  <!-- BAR CHART ----------------------------------------------------------->
  <div class="card">
    <h3>Participation — filter by Season (below)</h3>
    <div id="bar-view"></div>
    <div id="bar-controls" class="controls"></div>
  </div>

  <!-- DONUT CHART --------------------------------------------------------->
  <div class="card">
    <h3>Medal Mix by Country — pick a country (below)</h3>
    <div id="donut-view"></div>
    <div id="donut-controls" class="controls"></div>
  </div>

</div>

<script>
  // -------- Bar chart (athlete_events.csv): stacked by Sex, filtered by Season
  const barSpec = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "data":{
      "url":"https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/athlete_events.csv"
    },
    "width":1000, "height":360,
    "params":[
      {
        "name":"season_selection",
        "value": null,
        "bind":{
          "input":"select",
          "options":[null,"Summer","Winter"],
          "labels":["— All seasons —","Summer","Winter"],
          "name":"Season: ",
          "element":"#bar-controls"
        }
      }
    ],
    "transform":[
      {"filter":"!season_selection || datum.Season == season_selection"},
      {"aggregate":[{"op":"count","as":"Entries"}],"groupby":["Year","Sex"]}
    ],
    "encoding":{
      "x":{"field":"Year","type":"ordinal","title":"Year","axis":{"labelAngle":0}},
      "y":{"field":"Entries","type":"quantitative"},
      "color":{"field":"Sex","type":"nominal","scale":{"range":["#f3a6c6","#8fb9ff"]}}
    },
    "mark":{"type":"bar"}
  };

  // -------- Donut chart (olympic.csv): medal composition for selected country
  const donutSpec = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "data":{
      "url":"https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/olympic.csv"
    },
    "width":420,"height":320,
    "params":[
      {
        "name":"country_sel",
        "value": null,
        "bind":{
          "input":"select",
          "name":"Country: ",
          "options":[null,"United States of America","Germany","France","United Kingdom","China","Italy","Russia","Sweden","Japan","Australia","Netherlands","Canada","Norway","Hungary","Finland","Switzerland","Austria","Spain","Poland","Romania","Cuba","Bulgaria","Denmark","Ukraine","Belgium","Brazil","Greece","New Zealand","Czechia","Turkey","Kenya","Belarus","Argentina","Kazakhstan","South Africa","Mexico","Iran","Jamaica"],
          "labels":["— Select a country —"],
          "element":"#donut-controls"
        }
      }
    ],
    "transform":[
      {"filter":"country_sel != null ? datum.country == country_sel : false"},
      {"fold":["OlympicMedalsGold","OlympicMedalsSilver","OlympicMedalsBronze"],
       "as":["MedalType","Count"]},
      {"calculate":"replace(replace(replace(datum.MedalType,'OlympicMedals',''),'Total_2022','Total'),'YouthTotal','Youth')","as":"MedalTypeClean"}
    ],
    "view":{"stroke":null},
    "encoding":{
      "theta":{"field":"Count","type":"quantitative","stack":true},
      "color":{
        "field":"MedalTypeClean","type":"nominal",
        "scale":{"domain":["Gold","Silver","Bronze"],"range":["#d4af37","#c0c0c0","#cd7f32"]},
        "title":"Medal"
      },
      "tooltip":[
        {"field":"MedalTypeClean","title":"Medal"},
        {"field":"Count","type":"quantitative"}
      ]
    },
    "mark":{"type":"arc","innerRadius":90, "outerRadius":150}
  };

  vegaEmbed("#bar-view", barSpec, {actions:false});
  vegaEmbed("#donut-view", donutSpec, {actions:false});
</script>
</body>
</html>
