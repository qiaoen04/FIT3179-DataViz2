<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1200px;margin:auto;display:grid;grid-template-columns:1fr 1fr;gap:24px;padding:24px}
    .full{grid-column:1 / -1}
    .card{background:#fff;border-radius:12px;padding:14px;box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .controls{margin-top:10px}
    .controls label{margin-right:8px}
    h3{margin:6px 0 12px 4px}
  </style>
</head>
<body>

<div class="wrap">
  <!-- MAP (left) -->
  <div class="card">
    <h3>Olympic Medals by Country (Total)</h3>
    <div id="map-view"></div>
    <!-- map has no control UI -->
  </div>

  <!-- DONUT (right) -->
  <div class="card">
    <h3>Medal Mix — Select a Country (control below)</h3>
    <div id="donut-view"></div>
    <div id="donut-controls" class="controls"></div>
  </div>

  <!-- BAR (bottom, full width) -->
  <div class="card full">
    <h3>Participation by Year — Stacked by Sex (control below)</h3>
    <div id="bar-view"></div>
    <div id="bar-controls" class="controls"></div>
  </div>
</div>

<script>
  // ---------- MAP (choropleth) ----------
  // Uses world topojson + name TSV, then looks up olympic.csv by country name
  const mapSpec = {
        "title": "Olympic medals for each countries",
        "width": 800,
        "height": 400,
        "projection": {"type": "equalEarth"},
        "layer": [
          { "data": {"sphere": true},
            "mark": {"type": "geoshape", "fill":"#eef6fb", "stroke": null}
          },
          { "data": {"graticule": true},
            "mark": {"type": "geoshape", "stroke": "#c7d2d9", "strokeWidth": 0.5}
          },
          {
            "data": {
              "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
              "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
            },
            "mark": {"type": "geoshape", "fill": "#f2efe9", "stroke": "#ffffff", "strokeWidth": 0.3}
          },
          {
            "data": {
              "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
              "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
            },
            "transform": [
              {
                "lookup": "properties.NAME",
                "from": {
                  "data": {
                    "url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/olympic.csv"
                  },
                  "key": "country",
                  "fields": ["OlympicMedalsTotal_2022"]
                }
              },
              {"calculate": "toNumber(datum.OlympicMedalsTotal_2022)", "as": "Medals"}
            ],
            "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 0.3},
            "encoding": {
              "color": {
                "field": "Medals",
                "type": "quantitative",
                "scale": {"type": "log", "domainMin": 1},
                "legend": {"title": "Total medals", "orient": "right"}  
              },
              "tooltip": [
                {"field": "properties.NAME", "type": "nominal", "title": "Country"},
                {"field": "Medals", "type": "quantitative", "title": "Medals"}
              ]
            }
          }
        ]
      };

  // ---------- DONUT (country picker under chart) ----------
  const donutSpec = {
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "data":{"url":"https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/olympic.csv"},
    "width":540,"height":330,
    "params":[
      {
        "name":"country_sel",
        "value": null,
        "bind":{
          "input":"select",
          "name":"Country: ",
          "options":[null,"United States of America","Germany","France","United Kingdom","China","Italy","Russia","Sweden","Japan","Australia","Netherlands","Canada","Norway","Hungary","Finland","Switzerland","Austria","Spain","Poland","Romania","Cuba","Bulgaria","Denmark","Ukraine","Belgium","Brazil","Greece","New Zealand","Czechia","Turkey","Kenya","Belarus","Argentina","Kazakhstan","South Africa","Mexico","Iran","Jamaica"],
          "labels":["— Select a country here —"],
          "element":"#donut-controls"
        }
      }
    ],
    "transform":[
      {"filter":"country_sel != null ? datum.country == country_sel : false"},
      {"fold":["OlympicMedalsGold","OlympicMedalsSilver","OlympicMedalsBronze"],"as":["MedalType","Count"]},
      {"calculate":"replace(replace(replace(datum.MedalType,'OlympicMedals',''),'Total_2022','Total'),'YouthTotal','Youth')","as":"Medal"}
    ],
    "mark":{"type":"arc","innerRadius":95,"outerRadius":150},
    "encoding":{
      "theta":{"field":"Count","type":"quantitative"},
      "color":{
        "field":"Medal","type":"nominal",
        "scale":{"domain":["Gold","Silver","Bronze"],"range":["#d4af37","#c0c0c0","#cd7f32"]},
        "title":"Medal"
      },
      "tooltip":[{"field":"Medal"},{"field":"Count","type":"quantitative"}]
    },
    "view":{"stroke":null}
  };

  // ---------- BAR (Season picker under chart) ----------
  const barSpec = {
      "title": "Participation — Summer (Stacked Bars) + Winter (Lines)",
      "width": 1200,
      "height": 420,
      "data": {
        "url": "https://raw.githubusercontent.com/qiaoen04/FIT3179-DataViz2/main/athlete_events.csv",
        "format": {"type": "csv"}
      },
      "transform": [
        {"filter": "isValid(datum.Year) && datum.Sex != null && datum.Season != null"},
        {"aggregate": [{"op":"count","as":"Entries"}], "groupby": ["Year","Sex","Season"]}
      ],
      "encoding": {
        "x": {"field": "Year", "type": "quantitative", "axis": {"format": "d", "title": "Year"}},
        "color": {
  "field": "Sex",
  "type": "nominal",
  "scale": {"domain": ["F", "M"], "range": ["#f0add5", "#8bc8f0"]},
  "legend": {
    "title": "Sex",
    "orient": "right",
    "direction": "vertical",
    "titleFontSize": 12,
    "labelFontSize": 11,
    "symbolType": "circle",
    "offset": 10
  }
}



      },
      "layer": [
        {
          "name": "Summer (stacked bars)",
          "transform": [{"filter": "datum.Season == 'Summer'"}],
          "mark": {"type": "bar"},
          "encoding": {
            "y": {"field": "Entries", "type": "quantitative", "title": "Entries"},
            "size": {"value": 25},
            "opacity": {
              "condition": {"test": "season_selection == null || season_selection == 'Summer'", "value": 0.9},
              "value": 0
            },
            "tooltip": [
              {"field":"Year","type":"quantitative","format":"d","title":"Year"},
              {"field":"Season","type":"nominal","title":"Season"},
              {"field":"Sex","type":"nominal"},
              {"field":"Entries","type":"quantitative","format":",","title":"Entries"}
            ]
          }
        },
        {
          "name": "Winter (lines)",
          "transform": [{"filter": "datum.Season == 'Winter'"}],
          "mark": {"type": "line", "point": true, "strokeWidth": 2},
          "encoding": {
            "y": {"field": "Entries", "type": "quantitative"},
            "opacity": {
              "condition": {"test": "season_selection == null || season_selection == 'Winter'", "value": 1},
              "value": 0
            },
            "tooltip": [
              {"field":"Year","type":"quantitative","format":"d","title":"Year"},
              {"field":"Season","type":"nominal","title":"Season"},
              {"field":"Sex","type":"nominal"},
              {"field":"Entries","type":"quantitative","format":",","title":"Entries"}
            ]
          }
        },
        {
          "name": "Summer total labels (all years)",
          "transform": [
            {"filter": "datum.Season == 'Summer'"},
            {"aggregate": [{"op": "sum", "field": "Entries", "as": "Total"}], "groupby": ["Year"]}
          ],
          "mark": {"type": "text", "dy": -6, "fontSize": 11, "stroke": "black", "strokeWidth": 1},
          "encoding": {
            "x": {"field": "Year", "type": "quantitative"},
            "y": {"field": "Total", "type": "quantitative"},
            "text": {"field": "Total", "type": "quantitative", "format": ",d"},
            "opacity": {
              "condition": {"test": "season_selection == null || season_selection == 'Summer'", "value": 1},
              "value": 0
            },
            "tooltip": [
              {"field": "Year", "type": "quantitative", "format": "d", "title": "Year"},
              {"field": "Total", "type": "quantitative", "format": ",d", "title": "Summer total"}
            ]
          }
        }
      ]
    };

  vegaEmbed("#map-view", mapSpec, {actions:false});
  vegaEmbed("#donut-view", donutSpec, {actions:false});
  vegaEmbed("#bar-view", barSpec, {actions:false});
</script>
</body>
</html>
